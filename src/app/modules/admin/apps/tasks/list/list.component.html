<div class="content-layout right-sidebar-fullheight-basic-inner-scroll">

    <mat-drawer-container (backdropClick)="onBackdropClicked()">

        <!-- Drawer -->
        <mat-drawer [mode]="drawerMode"
                    [opened]="false"
                    [position]="'end'"
                    [disableClose]="true"
                    #matDrawer>

            <router-outlet></router-outlet>

        </mat-drawer>

        <mat-drawer-content>

            <!-- Main -->
            <div class="main">

                <!-- Header -->
                <div class="header">

                    <!-- Title -->
                    <div class="title">

                        <h2>Tasks</h2>

                        <div class="remaining-tasks-count">
                            {{tasksCount.notCompleted}} remaining tasks
                        </div>

                    </div>

                    <!-- Main actions -->
                    <div class="main-actions">

                        <!-- Add task button -->
                        <button class="add-task"
                                mat-flat-button
                                [color]="'primary'">
                            <mat-icon>add</mat-icon>
                            <span>Add Task</span>
                        </button>

                        <!-- Add section button -->
                        <button class="add-section"
                                mat-flat-button
                                [color]="'accent'">
                            <mat-icon>add</mat-icon>
                            Add Section
                        </button>

                    </div>

                </div>

                <!-- Search & Filters -->
                <div class="search-and-filters">

                    <mat-form-field class="asm-mat-simplify asm-mat-dense asm-mat-no-label asm-mat-no-subscript"
                                    [appearance]="'outline'">
                        <mat-icon matPrefix>search</mat-icon>
                        <input matInput
                               placeholder="Search tasks"
                               (input)="onSearch($event)"
                               #searchInput>
                    </mat-form-field>

                </div>

                <!-- Tasks list -->
                <div class="tasks-list"
                     cdkDropList
                     [cdkDropListData]="tasks"
                     (cdkDropListDropped)="dropped($event)">

                    <ng-container *ngIf="filteredTasks && filteredTasks.length > 0; else noTasks">

                        <!-- Task -->
                        <div class="task"
                             [class.completed]="task.completed"
                             [ngClass]="'type-' + task.type"
                             *ngFor="let task of filteredTasks; trackBy: trackById"
                             cdkDrag
                             [cdkDragDisabled]="!!searchInput.value">

                            <!-- Task content -->
                            <div class="task-content">

                                <!-- Drag handle -->
                                <div class="drag-handle"
                                     cdkDragHandle>
                                    <mat-icon>drag_indicator</mat-icon>
                                </div>

                                <!-- Complete task button -->
                                <button class="complete-task"
                                        *ngIf="task.type === 'task'"
                                        (click)="toggleCompleted(task)"
                                        mat-icon-button>

                                    <mat-icon [color]="'primary'"
                                              *ngIf="task.completed">
                                        check_circle
                                    </mat-icon>

                                    <mat-icon *ngIf="!task.completed">
                                        radio_button_unchecked
                                    </mat-icon>

                                </button>

                                <!-- Task link -->
                                <a [routerLink]="[task.id]">

                                    <div class="title">{{task.title}}</div>

                                    <div class="priority"
                                         *ngIf="task.type === 'task'">

                                        <!-- Low -->
                                        <mat-icon class="low"
                                                  *ngIf="task.priority === 0"
                                                  [title]="'Low'">
                                            arrow_downward
                                        </mat-icon>

                                        <!-- Normal -->
                                        <mat-icon class="normal"
                                                  *ngIf="task.priority === 1"
                                                  [title]="'Normal'">
                                            remove
                                        </mat-icon>

                                        <!-- High -->
                                        <mat-icon class="high"
                                                  *ngIf="task.priority === 2"
                                                  [title]="'High'">
                                            arrow_upward
                                        </mat-icon>

                                    </div>

                                    <div class="tags"
                                         *ngIf="task.type === 'task'">

                                        <div class="tag"
                                             *ngFor="let tag of (organizeTags(task.tags).visible); trackBy: trackById"
                                             [ngClass]="['text-' + tag.color, 'bg-' + tag.color + '-50']">
                                            {{tag.title}}
                                        </div>

                                        <div class="hidden-tags"
                                             *ngIf="organizeTags(task.tags).hidden"
                                             [matTooltip]="organizeTags(task.tags).hidden">
                                            <span>+{{organizeTags(task.tags).hidden.split(',').length}}</span>
                                        </div>

                                    </div>

                                </a>

                            </div>

                        </div>

                    </ng-container>

                    <ng-template #noTasks>
                        <div class="no-tasks">
                            <span *ngIf="!searchInput.value">There are no tasks!</span>
                            <span *ngIf="searchInput.value">No tasks found for <b>'{{searchInput.value}}'</b></span>
                        </div>
                    </ng-template>

                </div>

            </div>

        </mat-drawer-content>

    </mat-drawer-container>

</div>

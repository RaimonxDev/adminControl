<!-- Main -->

<!-- Products list -->
<div class="flex flex-col w-full">
  <!-- Table -->
  <ng-container *ngIf="productsCount > 0; else noProducts">
    <table
      class="w-full min-w-320 table-fixed bg-transparent"
      mat-table
      [matSortActive]="'marca'"
      [multiTemplateDataRows]="true"
      [dataSource]="filteredProductos | async"
      class="w-full"
      matSort
      matSortDirection="asc"
      (matSortChange)="resetPaging()"
    >
      <!-- Marca -->
      <ng-container matColumnDef="marca">
        <th mat-header-cell *matHeaderCellDef mat-sort-header disableClear>
          Marca
        </th>
        <td mat-cell *matCellDef="let row">
          {{ row.marca }}
        </td>
      </ng-container>
      <!-- Producto -->
      <ng-container matColumnDef="producto">
        <th mat-header-cell *matHeaderCellDef disableClear>Producto</th>
        <td mat-cell *matCellDef="let row">
          {{ row.producto }}
        </td>
      </ng-container>
      <!--Price-->
      <ng-container matColumnDef="price">
        <th mat-header-cell *matHeaderCellDef disableClear>Precio</th>
        <td mat-cell *matCellDef="let row">
          {{ row.precioSugerido }}
        </td>
      </ng-container>
      <!-- Stock -->
      <ng-container matColumnDef="stock">
        <th
          class="w-24 bg-gray-50 dark:bg-black dark:bg-opacity-5"
          mat-header-cell
          *matHeaderCellDef
          mat-sort-header
          disableClear
        >
          Stock
        </th>
        <td class="pr-4" mat-cell *matCellDef="let product">
          <span class="flex items-center">
            <span class="min-w-4">{{ product.stock }}</span>
            <!-- Low stock -->
            <span
              class="
                flex
                items-end
                ml-2
                w-1
                h-4
                bg-red-200
                rounded
                overflow-hidden
              "
              *ngIf="product.stock < 20"
            >
              <span class="flex w-full h-1/3 bg-red-600"></span>
            </span>
            <!-- Medium stock -->
            <span
              class="
                flex
                items-end
                ml-2
                w-1
                h-4
                bg-orange-200
                rounded
                overflow-hidden
              "
              *ngIf="product.stock >= 20 && product.stock < 30"
            >
              <span class="flex w-full h-2/4 bg-orange-400"></span>
            </span>
            <!-- High stock -->
            <span
              class="
                flex
                items-end
                ml-2
                w-1
                h-4
                bg-green-100
                rounded
                overflow-hidden
              "
              *ngIf="product.stock >= 30"
            >
              <span class="flex w-full h-full bg-green-400"></span>
            </span>
          </span>
        </td>
      </ng-container>

      <!-- Active-->
      <ng-container matColumnDef="active">
        <th mat-header-cell *matHeaderCellDef disableClear>Activo</th>
        <td mat-cell *matCellDef="let row">
          {{ row.disponible }}
        </td>
      </ng-container>
      <!-- Detelles-->
      <ng-container matColumnDef="details">
        <th mat-header-cell *matHeaderCellDef disableClear>Detalles</th>
        <td mat-cell *matCellDef="let producto">
          <button (click)="detailsProduct(producto)">
            <mat-icon svgIcon="heroicons_outline:document-search"></mat-icon>
          </button>
        </td>
      </ng-container>

      <!-- detalles Productos -->
      <ng-container matColumnDef="productDetails">
        <td
          class="p-0 border-b-0"
          mat-cell
          *matCellDef="let product"
          [attr.colspan]="productsTableColumns.length"
        >
          <!-- expansion panel -->
          <div
            class="shadow-sm overflow-hidden"
            [@detailExpand]="
              selectedProduct?.id === product.id ? 'expanded' : 'collapsed'
            "
          >
            <div class="flex border-b">
              <app-details-products
                class="w-full"
                [producto]="product"
              ></app-details-products>
            </div>
          </div>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="productsTableColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: productsTableColumns"></tr>
      <tr
        class="h-0"
        mat-row
        *matRowDef="let row; columns: ['productDetails']"
      ></tr>
    </table>
  </ng-container>

  <ng-template #noProducts>
    <h2
      class="
        text-3xl
        md:text-4xl
        font-extrabold
        tracking-tight
        leading-7
        sm:leading-10
        truncate
      "
    >
      No hay Pedidos
    </h2>
  </ng-template>

  <mat-paginator
    [length]="productsCount"
    [pageSize]="20"
    [pageSizeOptions]="[5, 10, 25, 100]"
  ></mat-paginator>
</div>
